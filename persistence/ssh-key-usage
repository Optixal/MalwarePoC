# Key Generation (client-side) (once)

mkdir ~/.ssh
chmod 700 ~/.ssh
ssh-keygen -t rsa -c comment  # Stored as ~/.ssh/id_rsa.pub (Public), ~/.ssh/id_rsa (Private)


# Install Public Key (server)

# Upload id_rsa.pub to server
meterpreter > mkdir ~/.ssh
meterpreter > upload ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys  # or
meterpreter > upload ~/.ssh/id_rsa.pub ~/.ssh/.
meterpreter > shell > cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
meterpreter > shell > service sshd reload

ssh sam@192.168.1.128 "mkdir ~/.ssh"
scp ~/.ssh/id_rsa.pub sam@192.168.1.128:~/.ssh/authorized_keys

# authorized_keys is a FILE not a folder!
# authorized keys MUST have the correct owner-user permission (eg. owned by root if it is placed in /root/.ssh/)


# Add Key to ssh-agent for Current Session:
eval $(ssh-agent)
ssh-add
ssh user@192.168.1.25  # Done


# [Optional] Convenience (for hacking) (client) (touch ~/.ssh/config (non-global config))
Host 192.168.0.*
   StrictHostKeyChecking no
   UserKnownHostsFile=/dev/null


# [Optional] Security (not for hacking) (server) (/etc/ssh/sshd_config)

# Disable password authentications, and only allow SSH keys
PasswordAuthentication no
UsePAM no

# Disable root login
PermitRootLogin no
